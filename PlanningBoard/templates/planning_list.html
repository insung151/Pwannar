{% extends 'base.html' %}
{% block content %}

  <form method="POST" action="{% url 'planningboard:alphabet' %}">
  {% csrf_token %}
    <button type="submit" id="alphabet" class='btn'>가나다순 정렬</button>
  </form>
  <form method="POST" action="{% url 'planningboard:recent' %}">
  {% csrf_token %}
    <button type="submit" id="recent" class="btn">최신순 정렬</button>
  </form>

  <div id="search_table">
  <div class="region_category" style="border: 1px solid black">

  <div id="region_title">
    <p>지역</p>
  </div>

  <div id="province_cateogory">
    <select name="province" id="province">
    <option value="" disabled selected>지역</option>
    {% for province in province_list %}
      <option value="{{ province.pk }}" id="{{ province.pk }}_province">{{ province.name }}</option>
    {% endfor %}
    </select>
  </div>

<form id="tag_search_form" method="POST">
{% csrf_token %}

  <div id="city_category" >
    {% for province in province_list %}
      <div class="{{ province.pk }}_city hide">
        <input type="checkbox" id="all_{{ province.pk }}" name="city_all" value="{{ province.pk }}">
        <label for="all_{{ province.pk }}">전체선택</label>
      </div>
      {% for city in province.subregions.all %}
      <div class="{{ province.pk }}_city hide" style="display: inline-block;">
        <input type="checkbox" id="{{ city.pk }}_city" name="city" value="{{ city.pk }}">
        <label for="{{ city.pk }}_city">{{ city }}</label>
      </div>
      {% endfor %}
    {% endfor %}
  </div>

  <div class="language_category">
    <div id="language_title">
      <p>언어</p>
    </div>
    <div id="language_category">
      <input type="checkbox" id="language_all" name="language_all" value="all">
      <label for="language_all">전체선택</label>
    {% for language in language_list %}
      <div class="{{ language.pk }}_language">
        <input type="checkbox" id="language_{{ language.pk }}" name="language" value="{{ language.pk }}">
        <label for="language_{{ language.pk }}">{{ language }}</label>
      </div>
    {% endfor %}
    </div>
  </div>

  <div class="project_category">
    <div id="project_title">
      <p>프로젝트</p>
    </div>
    <div id="project_category">
    <input type="checkbox" id="project_all" name="project_all" value="all">
    <label for="project_all">전체선택</label>
    {% for project in project_list %}
      <div class="{{ project.pk }}_project">
        <input type="checkbox" id="project_{{ project.pk }}" name="project" value="{{ project.pk }}">
        <label for="project_{{ project.pk }}">{{ project }}</label>
      </div>
    {% endfor %}
    </div>
  </div>
  <button id="search_button" type="submit">검색</button>
</form>
  </div>
</div>
  <a id="create_button" href="{% url 'planningboard:create' %}" class="waves-effect waves-light btn">글쓰기</a>

<script>

$(document).ready(function() {
    $('select[name="province"]').val('{{ selected_province_pk }}');
    $('select').material_select();
    {% for city in selected_city_pk %}
        $('#{{ city }}_city').get(0).checked=true;
    {% endfor %}
    if ({{ selected_province_pk }} != 0){
        $('select').change();
    }
    {% if selected_region_all %}
        $('#all_'+{{ selected_region_all }}).click();
    {% endif %}
  });

var target= document.getElementById("province");
var selected_province_pk = target.options[target.selectedIndex].value;
$('select[name="province"]').change(function () {
    $('div.'+selected_province_pk+'_city').addClass('hide');
    for (var i=0; i< $('div.'+selected_province_pk+'_city input').length; i++){
         $('div.'+selected_province_pk+'_city input').get(i).checked = false
    }
    selected_province_pk = target.options[target.selectedIndex].value;
    $('div.'+selected_province_pk+'_city').removeClass('hide');
    var checkboxes = $('input[type="checkbox"]');
    for (var i=0; i<checkboxes.length; i++){
        checkboxes.get(i).disabled=false;
    }
});

$('input[name="city_all"]').click(function () {
    var checkboxes = $('input[name="city"]');
    if($(this).is(':checked')){
        for(var i=0; i<checkboxes.length; i++){
            checkboxes.get(i).checked = false;
            checkboxes.get(i).disabled = true;
        }
    }else{
        for(var i=0; i<checkboxes.length; i++){
            checkboxes.get(i).disabled = false;
        }
    }
})
$('#language_all').click(function () {
    var language_checkboxes = $('input[name="language"]');
    if($(this).is(':checked')){
        console.log(language_checkboxes.length);
        for (var i=0; i<language_checkboxes.length; i++){
            language_checkboxes.get(i).disabled = true;
            language_checkboxes.get(i).checked = false;
        }
    }else {
        for (var i=0; i<language_checkboxes.length; i++){
            language_checkboxes.get(i).disabled = false;
        }
    }
})

$('#project_all').click(function () {
    var project_checkboxes = $('input[name="project"]');
    if($(this).is(':checked')){
        for (var i=0; i<project_checkboxes.length; i++){
            project_checkboxes.get(i).disabled = true;
            project_checkboxes.get(i).checked = false;
        }
    }else {
        for (var i=0; i<project_checkboxes.length; i++){
            project_checkboxes.get(i).disabled = false;
        }
    }
})
</script>
  <div id="detail_list">
      <ul class="collection">
  {% for detail in detail_list %}
    <li id="{{ detail.pk }}" class="collection-item avatar">
      <a href = "{% url 'planningboard:detail' detail.pk %}">
        <img src = "{{ detail.image_url }}" alt="" style="width: 50px; height: 50px">
        <a href = "{% url 'planningboard:detail' detail.pk %}">
          <span class="title">{{ detail.title }}/{{ detail.created_at }}</span>
        </a>
        <p>{{ detail.author }}</p>
      </a>
    </li>
  {% endfor %}
      </ul>
  </div>
<script>

  var details = document.getElementsByClassName("collection-item avatar");
  var selected_detail_list = []
  for(var i=0; i < details.length; i++){
    selected_detail_list.push(details[i].id);
  }
  var data = {selected_detail_list: selected_detail_list};

$('#alphabet').click(function(e){
  e.preventDefault();
  alert('알파벳!');

    var url = "{% url 'planningboard:alphabet' %}";
  $.post(url, data)
    .done(
    function(r){
      $('ul.collection').replaceWith(r)
    })
    .fail(function(){
      alert('Error!')
    })
});

$('#recent').click(function(e){
  e.preventDefault();
  alert('최신순!');

  var url = "{% url 'planningboard:recent' %}";
  $.post(url, data)
    .done(
    function(r){
      $('ul.collection').replaceWith(r)
    })
    .fail(function(){
      alert('Error!')
    })
});


</script>
{% endblock %}