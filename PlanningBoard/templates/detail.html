{% extends 'base.html' %}

{% block content %}
  <script>
    function message(url){
        window.open(url, "", "width=1000px, height=800px");
    }
  </script>

<!-- 본문영역 -->
<img class="responsive-img" src = "{{ detail.image_url }}">
<p>제목: {{ detail.title }}</p>
<p>저자: {{ detail.author }}</p>
<p>모집기간: {{ detail.recruiting_period }}</p>
<p>모집인원: {{ detail.recruiting_number }}</p>

<p>설명: {{ detail.description }}</p>

<p>태그</p>

  {% for subregion in detail.subregion.all %}
    <a href="{% url 'planningboard:list' %}?selected_city_pk=[{{ subregion.pk }}]" id="{{ subregion.pk }}_subregion_name"class="chip">{{ subregion.name }}</a>
  {% endfor %}

<div id="project_tag_wrapper">
{% for project in detail.project.all %}
<a href="#" id="{{ project.pk }}" class="chip">{{ project.name }}</a>
{% endfor %}
</div>

<div id="language_tag_wrapper">
{% for language in detail.language.all %}
<a href="#" id="{{ language.pk }}" class="chip">{{ language.name }}</a>
{% endfor %}
  <div id="like_button_wrapper" style="width: 50px; border:1px solid black">
    <a id="like_button2" href="{% url 'planningboard:like' detail.pk %}">
    {% include 'like_button.html' %}
    </a>
    <script>
      $('#like_button2').click(function (e) {
      var self = $(this);
      var url = self.attr('href');
      $.post(url)
          .done(function(r){
              self.html(r);
          })
          .fail(function () {
              alert('오류가 발생했습니다.');
          });
      return false;
    });
    </script>
  </div>
  <button onclick="message('{% url 'message:apply' detail.team.pk %}')">신청하기</button>

{% if request.user == detail.author %}
<a href="{% url 'planningboard:update' detail.pk %}" type = "button">수정하기</a>
{% endif %}
  <form id='delete_form' action="{% url 'planningboard:delete' detail.pk %}" method="POST" style="display: inline-block;">
    {% csrf_token %}
    <button type="submit" class="waves-effect waves-light btn">삭제하기</button>
</form>
<script>
    $('#delete_form').submit(function(e){
            if (!confirm('지우시겠습니까?')) {
                e.preventDefault();
            }
    });
</script>
<a href="{% url 'planningboard:list' %}">목록으로</a>
<!--본문 영역 끝-->

<!--댓글 영역 -->

<form id="comment_form" action="{% url 'planningboard:comment_create' detail.pk %}" method="POST">
{% csrf_token %}
    {{ comment_form.as_p }}
  <button  type="submit">댓글달기</button>
</form>

<script>

$('#comment_form').submit(function(e){
  e.preventDefault();

  var url = "{% url 'planningboard:comment_create' detail.pk %}";
  var data = {content: $('input[name="content"]').val() };
  console.log(url);

  $.post(url, data)
    .done(function(r){
      $('#comment_list').prepend(r);
      $('input[name="content"]').val('');
    })
    .fail(function(){
      alert('오류가 발생했습니다.');
    });
})

</script>

<ul id="comment_list">
  {% for comment in comment_list %}
    <li>
      {% include 'comment_list.html' %}
    </li>
  {% endfor %}
</ul>

<!--댓글 영역 끝-->

{% endblock %}
